<!DOCTYPE html>
<html>
  <head>
    <title>{{ title }}</title>
    
   
    
   <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css'/>
   <link rel='stylesheet' href='/stylesheets/style.css' />
    <!-- <link rel='stylesheet' href='/stylesheets/flat-ui.css'/> -->
  </head>
  <body>
    <!-- Her kommer navbaren -->
    <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">{{name}}</a>
    </div>

    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        {{#links}}
        <li><a href={{url}}>{{name}}</a></li>
        {{/links}}
      </ul>
       
      <ul class="nav navbar-nav navbar-right">
      
           <li><button id="logout" class="btn btn-success navbar-btn">Logg ut</button></li> 
              
          </ul>
        
      </ul>
    </div>
  </div>
</nav>

<br>
    <div class="col-md-4">
      <div class="panel panel-default">
        <div class="container-fluid">
          <div class="panel-header"><button data-toggle="collapse" data-target="#panelinfo" id="infobutton" style="
            right: 16px;
            border-style:none;
            margin: 0;
            position: absolute;
            "class="btn btn-default glyphicon glyphicon-option-horizontal"></button><h4>Siste brukere</h4></div>
            <div class="panel-body panel-collapse collapse in"  id="panelinfo">
              <!-- dette er sistebrukerpanelet der siste brukere kommer -->
                <ul class="list-group" id="brukerlist">
                   <!-- her kommer det data dynamisk inn -->
                </ul>
            </div>
        </div>
      </div>
    </div>

    <div class="col-md-5">
     <div  class="panel panel-default">
        <div class="container-fluid">
            <div class="panel-header"><button data-toggle="collapse" data-target="#panelstatistikk" style="
            right: 16px;
            border-style:none;
            margin: 0;
            position: absolute;
            "class="btn btn-default glyphicon glyphicon-option-horizontal"></button><h4>Aktivitet</h4></div>
            <div class="scaling panel-body panel-collapse collapse in " id="panelstatistikk">

              <div class="col-md-3">
                <a href="" class="thumbnail">
                  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/86/Microsoft_Excel_2013_logo.svg/110px-Microsoft_Excel_2013_logo.svg.png" />
                </a>

              </div>

              <div class="col-md-2"><label class="label label-info">Excel er koplet til databasen og kjører</label><br><label class="label label-success">Online</label></div>

              <br><br><br> 

             
                <h4>Siste aktivitet</h4>
               
                <table id="tbl" class="table table-striped">
                   <tr>
                        <td>
                          Bruker
                        </td> 
                        <td>
                          Sist inlogget
                        </td>
                        <td>
                          Sist utlogget
                        </td>
                        <td>
                          Sist aktiv
                        </td>
                        <td>
                          Arbeidstimer totalt(idag)
                        </td>
                    </tr>

                    
                </table>
              <br>
              
            </div>
          
            </div>
      </div>

      
    </div>

    <div class="col-md-3">
     <div class="panel panel-default ">
        <div class="container-fluid">
            <div class="panel-header"><button style="
            right: 16px;
            border-style:none;
            margin: 0;
            position: absolute;
            "class="btn btn-default glyphicon glyphicon-option-horizontal" data-toggle="collapse" data-target="#panelbrukere"></button><h4>Brukere</h4></div>
            <div id="panelbrukere" class="panel-body panel-collapse collapse in ">
        
            <ul class="list-group">
               <input type="text" class="form-control" placeholder="Søk etter bruker.." id="searchbruker" />
            </ul>

          </div>
        
        </div>
      </div>
    </div>

    <div class="col-md-12">
      
        <div class="panel panel-default">
                  <div class="container-fluid">

          <div class="panel-header"><button style="
            right: 16px;
            border-style:none;
            margin: 0;
            position: absolute;
            " class="btn btn-default glyphicon glyphicon-option-horizontal" data-toggle="collapse" data-target="#panel-graf"></button>   <h4>Graf</h4></div>
             <div class="panel-body panel-collapse collapse in " id="panel-graf">
                <div id="graf">

                </div>
           </div>
         </div>
        </div>

    <!-- modals:: -->
    {{#brukere}}
    <div id="modelcontainer">
    <div class="modal fade" id="modaluser{{id}}" tabindex="-1" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">{{title}} | {{bedrift}}</h4>
          </div>
          <div class="modal-body">
            <p>Bruker: {{name}}&hellip;</p>
            <input type="text" class="form-control" placeholder="Navn.." id="brukerNavn"/>

          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Lukk</button>
            <button type="button" class="btn btn-primary">Lagre endringer</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    </div>
    {{/brukere}}
  </body>
  <!-- JQuery og Bootstrap -->
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
  <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  <script type="text/javascript">
        var sistebrukere = $('#brukerlist');
        var socket = io('http://localhost:8080');
          socket.on('new message', function (data) {
              alert('Hello: ' + data.name + ', \n' + data.text);

          });

          socket.on('recieveJSON', function(data){
              var s = '<tr>' + 
              '<td>' + data.name +  '</td>' + '<td>' + data.desc +  '</td>' + 
              '<td>' + data.registered +  '</td>' + '<td>' + data.left +  '</td>'  + '</tr>';
              
              $('#tbl').append(s);
                 var data = [
                  {
                    x: [data.registered],
                    y: [1],
                    type: 'scatter'
                  }
                ];

                Plotly.newPlot('graph', data);

               
          });

          socket.on('getBrukere', function(data){
                console.log(data.personer);
                $('<div class="dropdown">',{id: data.personer.id}).appendTo(sistebrukere);
                $('<li/>', {'id': "listitem" + data.personer.id, 'text': data.personer.name, 'class': 'list-group-item clearfix'}).appendTo(sistebrukere);
                $('<span/>', {'id': 'span' + data.personer.id,'class': 'pull-right'}).appendTo('#listitem' + data.personer.id);
                var limain = $('#span' + data.personer.id);

                //UL liste for brukere, de fire siste
                $('<ul/>', {'id': 'dropdownlist' + data.personer.id, 'class': 'dropdown-menu'}).appendTo(limain);
                $('<li/>', {'id': 'li' + data.personer.id}).appendTo($('#dropdownlist' + data.personer.id));
                $('<a/>', {'data-toggle': 'modal', 'data-target': '#modaluser' + data.personer.id, 'text': 'Rediger bruker'}).appendTo($('#li' + data.personer.id));
                $('<li/>', {'id': 'li' + data.personer.id + 'one'}).appendTo($('#dropdownlist' + data.personer.id));
                $('<a/>', {'text': 'Status'}).appendTo($('#li' + data.personer.id + 'one'));
                $('<li/>', {'class': 'divider', 'role': 'seperator'}).appendTo($('#dropdownlist' + data.personer.id));
                $('<li/>',{'id': 'li' + data.personer.id + 'to'}).appendTo($('#dropdownlist' + data.personer.id));
                $('<a/>', {'text': 'Slett bruker'}).appendTo($('#li' + data.personer.id + 'to'));

                $('<button/>',{'id': 'buttonrediger' + data.personer.id, 'style': 'font-size: x-small ; height:25px;', 
                'class': 'btn btn-default dropdown-toggle', 'data-toggle': 'dropdown', 'aria-hashpopup':'true', 'aria-expanded': 'false'}).appendTo(limain);
                $('<span/>', {'class': 'caret'}).appendTo($('#buttonrediger' + data.personer.id));

                //modal:
                var modelcontainer = $('#modalcontainer');
                
                $('<div/>', {
                'class': 'modal fade', 
                'id': 'modalMain' + data.personer.id,
                'tabindex': '-1',
                'role': 'dialog'
                
                }).appendTo(modelcontainer);

                var modelmain = $('#modalMain' + data.personer.id);

                $('<div/>', {'class':'modal-dialog', 'id':'modaldialog' + data.personer.id}).appendTo(modelMain);

                var modaldialog = $('#modaldialog' + data.personer.id);

                $('<div/>', {'class': 'modal-content', 'id': 'modalcontent' + data.personer.id}).appendTo(modaldialog);

                var modalcontent = $('#modalcontent' + data.personer.id);

                $('<div/>', 'class':'modal-header', 'id':'modalheader' + data.personer.id).appendTo(modalcontent);

                var modalheader = $('#modalheader' + data.personer.id);

                //desse DOM objektene skal i modalheaderen
                $('<button/>', {'type': 'button', 'class': 'close', 'data-dismiss': 'modal',
                 'aria-label': 'Lukk', 'id': 'modalclosebutton' + data.personer.id}).appendTo(modalheader);
                $('<span/>' {'aria-hidden': 'true', 'text':'&times;'}).appendTo($('#modalclosebutton' + data.personer.id));
                $('<h4/>', {'class': 'modal-title', 'text': {{title}} + "|" + data.personer.bedrift).appendTo(modalheader);

                //desse DOM objektene skal i modelbody
            <button type="button" class="close" data-dismiss="modal" 
            aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">{{title}} | {{bedrift}}</h4>
          </div>
          <div class="modal-body">
            <p>Bruker: {{name}}&hellip;</p>
            <input type="text" class="form-control" placeholder="Navn.." id="brukerNavn"/>

          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Lukk</button>
            <button type="button" class="btn btn-primary">Lagre endringer</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    </div>
          });

          socket.on('registerUser', function(data){

              $.ajax({
                url: '/index/getSistebrukere',
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                success: function(data){

                }
              });
          });
        socket.connect();
        
         
        
        {{#brukere}}
          $('#person{{id}}').click(function () {
            console.log('hello{{id}}');
            $('#dropdownlist{{id}}').closest(".dropdown-menu").prev().dropdown("toggle");
          });

           
        {{/brukere}}


        $('#logout').click(function(){
          socket.emit('hello', {name: 'Marius Sørenes', age: '20'});
          
          $.ajax({
            url: '/index/userdisconnect',
            type: 'POST',
            success: function(data){
            }

        });
        });

        

        $(document).ready(function(){

          //getsistebrukere
          

              $.ajax({
                url: '/index/getSistebrukere',
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                success: function(data){
                   console.log(data);
                }
              });

          var data = [
                  {
                    name: 'Marius Sørenes',
                    text: ['Tid: 09.03-14.00', 'Tid: 08.00-12.03', 'Tid: 12.03-15.00'],
                    x: ['13.06.2016','14.06.2016','15.06.2016'],
                    y: [5,4,3],
                    type: 'scatter'
                  
                  },
                  {
                    name: 'Johannes Steinsbø',
                    text: ['Tid: 09.03-10.00', 'Tid: 12.00-14.03', 'Tid: 14.03-18.00'],
                    x: ['13.06.2016','14.06.2016','15.06.2016'],
                    y: [1,2,4],
                    type: 'scatter'
                  }
                ];

                var layout = {title: 'EasyTime - Graf', yaxis: {title: 'Antall timer'}, xaxis: {title: 'Dato'}};

                Plotly.newPlot('graf', data, layout,
                  {displayModeBar: false}
                  );

                  //{modeBarButtonsToRemove: ['sendDataToCloud','hoverCompareCartesian', 'zoom2d', 'pan2d', 'select2d', 'lasso2d', 'zoomIn2d', 'autoScale2d', 'resetScale2d','hoverClosestCartesian','hoverCompareCartesian']}
        });
        
          

  </script>
  </html>